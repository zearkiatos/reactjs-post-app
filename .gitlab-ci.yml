image: docker
services:
  - docker:dind

before_script:
  - docker info
  - docker-compose --version

stages:
  - install
  - build

install-dependencies:
  stage: install
  script:
    - apk add --no-cache docker-compose

build-app:
  stage: build
  variables:
    ENVIRONMENT: 'staging'
  dependencies:
    - install-dependencies
  script:
    - docker-compose up -d
  only:
    - branches